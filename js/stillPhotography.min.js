(function(){let e,t,o=Array.from(document.querySelectorAll(".column")),r=document.querySelector(".loadMoreBox"),n=0;const s=function(e){return new Promise(t=>{let o=new XMLHttpRequest;o.open("GET","../json/imageList.json"),o.onreadystatechange=(()=>{if(4===o.readyState&&200===o.status){let t=JSON.parse(o.responseText);e(t)}}),o.send()})};let l=sessionStorage.getItem("data");l?console.log("请求成功「缓存」：",JSON.parse(l)):s().then(e=>{console.log("请求成功：",e),sessionStorage.setItem("data",JSON.stringify(e))});const i=function(r){e=document.querySelectorAll(".column")[0].clientWidth,console.log(e),r.forEach(t=>{let{height:o,width:r}=t;return t.height=e/(r/o),t});let n,s=0;for(;s<r.length;s+=4)n=r.slice(s,s+4),n.sort((e,t)=>e.height-t.height),o.sort((e,t)=>t.offsetHeight-e.offsetHeight),n.forEach((e,t)=>{let{num:r,height:n,width:s,smallImage:l,largeImage:i}=e,a=document.createElement("div");a.className="cell",a.innerHTML=`\n                <a href="largeImage.html?num=${r}">\n                    <div class="pic"  style="height:${n}px"><img src="" data-src="${l}" alt="" style="height:${n}px"></div>\n                </a>\n            `,o[t].appendChild(a)});t=Array.from(document.querySelectorAll("img[data-src]"))};let a=new IntersectionObserver(e=>{e.forEach(e=>{let{isIntersecting:t,target:o}=e;if(t){let e=o.querySelector("img");e.src=e.getAttribute("data-src"),e.onload=(()=>e.style.opacity=1),a.unobserve(o),e.removeAttribute("data-src")}})},{threshold:[.5]});const c=function(){console.log(1),t.forEach(e=>{a.observe(e.parentNode)})};let g=new IntersectionObserver(e=>{let t=e[0];if(t.isIntersecting){if(n++,n>3)return r.innerHTML="全部数据都已经加载完毕了~~",void g.unobserve(t.target);s(function(e){i(e),c(),g.observe(r)})}});s(function(e){i(e),c(),g.observe(r)})})();