let topArea=document.querySelector(".top"),listArea=document.querySelector(".list"),offsetWid=document.documentElement.clientWidth,offsetHei=document.documentElement.clientHeight;topArea.style.height=offsetHei+"px",listArea.style.height=offsetHei+"px",window.onresize=function(){offsetWid=document.documentElement.clientWidth,offsetHei=document.documentElement.clientHeight,topArea.style.height=offsetHei+"px",listArea.style.height=offsetHei+"px"};const imgCircle=function(t){let e=document.querySelector(".backArea .back");"moveeee"==t?e.classList.add("backActive"):"stopppp"==t&&(e.classList.remove("backActive"),e.style.transform="ratate(0deg)")},commitQuery=function(t){let e=document.querySelector(".commitList");const n=function(t){return new Promise(e=>{let n=new XMLHttpRequest;n.open("GET","../json/commit.json"),n.onreadystatechange=(()=>{if(4===n.readyState&&200===n.status){let e=JSON.parse(n.responseText);t(e)}}),n.send()})};let i=sessionStorage.getItem("data");i?console.log("请求成功「缓存」：",JSON.parse(i)):n().then(t=>{console.log("请求成功：",t),sessionStorage.setItem("data",JSON.stringify(t))});const s=function(t,n){t.forEach(t=>{t.songName==n&&t.hotComments.forEach(t=>{let{content:n,user:i,time:s}=t;da=new Date(s);let r=da.getFullYear()+"年",o=da.getMonth()+1+"月",c=da.getDate()+"日";c=[r,o,c].join(""),avatarUrl=i.avatarUrl,nickname=i.nickname;let a=document.createElement("div");a.className="eachCommit",a.innerHTML=`<div>\n                    <img src="${avatarUrl}" alt="">\n                </div>\n                <div>\n                    <p class="userName">${nickname}</p>\n                    <span>: ${n}</span>\n                    <p class="date">${c}</p>\n                </div>\n                `,e.appendChild(a)})})};n(function(n){e.innerHTML="",s(n,t)})};let currentSSS="Opening";commitQuery(currentSSS),function(t){let e,n,i,s=["../music/Opening.mp3","../music/脚踏车.mp3","../music/早操.mp3","../music/淡水海边.mp3","../music/斗琴.mp3","../music/湘伦小雨四手联弹.mp3","../music/Ride With Me.mp3","../music/父与子.mp3","../music/情人的眼泪.mp3","../music/First Kiss.mp3","../music/女孩别为我哭泣.mp3","../music/晴天娃娃.mp3","../music/阿郎与阿宝.mp3","../music/与父共舞.mp3","../music/路小雨.mp3","../music/The Swan.mp3","../music/Flash Back.mp3","../music/Secret (慢板).mp3","../music/Angel.mp3","../music/小雨写立可白Ⅰ.mp3","../music/小雨写立可白Ⅱ.mp3","../music/Secret (加长快板).mp3","../music/琴房.mp3","../music/Ending.mp3","../music/不能说的秘密.mp3"],r=s,o=document.querySelector(".list"),c=document.querySelector(".songTitle p"),a=0,u="Opening";const l=document,h=t.addEventListener,m=t.removeEventListener,p={createEle:function(t,e){e=e||"div";const n=l.createElement(e);return n.className=t,n},append:function(t,e){t&&(e=Array.isArray(e)?e:e?[e]:[],e.forEach(e=>{e&&e.nodeType&&t.appendChild(e)}))},on:function(t,e){t&&e&&Object.keys(e)&&Object.keys(e).forEach(function(n){t.addEventListener(n,function(t){e[n].call(this,t)})})},formatTime:function(t){let e,n=0,i=0,s=0,r=":";return n=parseInt(t%60),i=parseInt(t/60%60),s=parseInt(t/60/60%60),e=parseInt(t/60/60%60)>0,n=("0"+n).slice(-2),i=("0"+i).slice(-2),(e?s+":":"")+i+r+n}},d=function(){this.audio=null,this.srcs=s,this.controller=null,this.progress=null,this.volume=null,this.isPlaying=!1,this.currentIndex=0,this.meta={currentTime:0,duration:0},this.init()};d.prototype={init:function(){this.audio=this.createAudio(),this.controller=new g(this),this.progress=new x(this),this.volume=new y(this);const t=l.querySelector(".audio");p.append(t,[this.controller.controllerArea,this.progress.progressDOM,this.volume.volumeArea]),this.onEvents()},createAudio:function(){const t=p.createEle("audio-player","audio");return t.src=this.srcs[this.currentIndex],t.preload="auto",t},onEvents:function(){const t=this,{formatTime:e}=p;p.on(this.audio,{loadedmetadata:function(){t.meta.duration=this.duration,t.progress.changeEndTime(e(this.duration))},timeupdate:function(){const n=t.meta;n.currentTime=this.currentTime,t.progress.changeCurrentTime(e(this.currentTime));const i=100*(this.currentTime/n.duration).toFixed(6);t.progress.setCurrentProgress(i)},ended:function(){t.next()}})},changeCurrentSrc:function(t){const e=this.audio;if("next"===arguments.callee.caller.name)if(t&&1===t.length){let s=r.indexOf(t.toString());a++,n=s+a,n>r.length-1?(n=0,a-=r.length,e.src=r[n],currentSong=r[n].split("/")[2].split(".")[0],c.innerText=currentSong,i=currentSong,u=i,commitQuery(i),e.load()):(e.src=r[n],currentSong=r[n].split("/")[2].split(".")[0],c.innerText=currentSong,i=currentSong,u=i,commitQuery(i),e.load())}else e.src=this.srcs[this.currentIndex],currentSong=r[this.currentIndex].split("/")[2].split(".")[0],c.innerText=currentSong,i=currentSong,u=i,commitQuery(i),e.load();else if("prev"===arguments.callee.caller.name)if(t&&1===t.length){let s=r.indexOf(t.toString());a--,n=s+a,n<0?(n=r.length-1,a=r.length-1-s,e.src=r[n],currentSong=r[n].split("/")[2].split(".")[0],c.innerText=currentSong,i=currentSong,u=i,commitQuery(i),e.load(),e.load()):(e.src=r[n],currentSong=r[n].split("/")[2].split(".")[0],c.innerText=currentSong,i=currentSong,u=i,commitQuery(i),e.load())}else e.src=this.srcs[this.currentIndex],currentSong=r[this.currentIndex].split("/")[2].split(".")[0],c.innerText=currentSong,i=currentSong,u=i,commitQuery(i),e.load()},play:function(){this.audio.play(),this.isPlaying=!0,console.log(1),imgCircle("moveeee")},pause:function(){this.audio.pause(),this.isPlaying=!1,imgCircle("stopppp")},prev:function(t){const e=this.currentIndex-1;this.currentIndex=e<0?this.srcs.length-1:e,this.changeCurrentSrc(t),this.play()},next:function(t){const e=this.currentIndex+1;this.currentIndex=e>this.srcs.length-1?0:e,this.changeCurrentSrc(t),this.play()},setCurrentTime:function(t){t=t||0,this.audio.currentTime=this.meta.duration*t},setCurrentVolume:function(t){this.audio.volume=t||0}};const g=function(t){this.$parent=t,this.controllerArea=null,this.prevIcon=null,this.stateIcon=null,this.nextIcon=null,this.isPlaying=!1,this.init()};g.prototype={init:function(){const{createEle:t,append:e}=p,n=t("audio-controller");this.prevIcon=t("fa fa-step-backward icon__back","i"),this.stateIcon=t("fa fa-play icon__state","i"),this.nextIcon=t("fa fa-step-forward icon__next","i"),e(n,[this.prevIcon,this.stateIcon,this.nextIcon]),this.controllerArea=n,this.onEvents()},changeStateIcon:function(){const{isPlaying:t,stateIcon:e}=this,n=t?"fa-pause":"fa-play",i=t?"fa-play":"fa-pause";e.className=e.className.replace(n,i)},changeState:function(){this.isPlaying=!this.isPlaying},onEvents:function(){const t=this,{on:e}=p;var n;e(this.prevIcon,{click:function(){t.isPlaying?(n=t.$parent.srcs,t.$parent.prev(n)):(n=t.$parent.srcs,t.changeStateIcon(),t.changeState(),t.$parent.prev(n))}}),e(this.nextIcon,{click:function(){t.isPlaying?(n=t.$parent.srcs,t.$parent.next(n)):(n=t.$parent.srcs,t.changeStateIcon(),t.changeState(),t.$parent.next(n))}}),e(this.stateIcon,{click:function(){t.changeStateIcon(),t.changeState(),t.isPlaying?t.$parent.play():t.$parent.pause()}})}};const f=function(t,e,n){this.$parent=t,this.sliderBox=null,this.progressBox=null,this.thumbBox=null,this.isBuffer=e||!1,this.isDragging=!1,this.startX=0,this.startPosition=n||0,this.currentPosition=n||0,this.currentValue=0,this.init()};f.prototype={init:function(){const{createEle:t,append:e}=p,n=t("slider"),i=t("slider-progress"),s=t("slider-runway");e(s,t("thumb")),e(n,[i,s]),this.isBuffer&&e(i,t("progress-buffer")),this.sliderBox=n,this.progressBox=i,this.thumbBox=s,this.currentPosition&&this.updateView(),this.onEvents()},onEvents:function(){const t=this,{thumbBox:e,sliderBox:n}=this,{on:i}=p;i(e,{mousedown:function(e){e.stopPropagation(),t.dragStart(e),h("mousemove",function(e){t.dragging(e)}),h("mouseup",function(){t.dragEnd()})}}),i(n,{click:function(e){const n=this.getBoundingClientRect(),i=(e.clientX-n.left)/n.width*100;t.currentPosition=Math.max(0,Math.min(i,100)),t.updateView(),t.changeAudioAbort()}})},changeAudioAbort:function(){let t=.01*this.currentPosition;if(this.isBuffer)this.$parent.changeAudioCurrTime(t);else{const e=Math.max(0,Math.min(t.toFixed(1),1));this.$parent.setCurrentVolume(e)}},updateView:function(){const{thumbBox:t,progressBox:e}=this,n=this.currentPosition;this.currentValue=Math.floor(n),t.style.left=n+"%",e.style.width=n+"%"},changeCurrentPosition:function(t){this.isDragging||(this.currentPosition=t||0,this.updateView())},setPosition:function(t){const{sliderBox:e,thumbBox:n}=this,i=e.offsetWidth,s=t-this.startX,r=100*(s/i).toFixed(6);this.currentPosition=Math.max(0,Math.min(this.startPosition+r,100)),this.updateView()},dragStart:function(t){this.isDragging=!0,this.startX=t.clientX,this.startPosition=this.currentPosition},dragging:function(t){this.isDragging&&(this.setPosition(t.clientX),this.isBuffer||this.changeAudioAbort())},dragEnd:function(){this.changeAudioAbort(),this.isDragging=!1,m("mousemove",this.dragging),m("mouseup",this.dragEnd)}};const x=function(t){this.$parent=t,this.slider=new f(this,!0),this.progressDOM=null,this.curTimeDOM=null,this.endTimeDOM=null,this.currentTime="00:00",this.endTime="00:00",this.init()};x.prototype={init:function(){const{createEle:t,append:e}=p,n=t("time__current","span"),i=t("time__end","span"),s=t("audio-progress"),r=t("slider-container");e(r,this.slider.sliderBox),e(s,[n,r,i]),this.curTimeDOM=n,this.endTimeDOM=i,this.setCurrentTimeText(),this.setEndTimeText(),this.progressDOM=s},changeCurrentTime:function(t){this.currentTime=t,this.setCurrentTimeText()},changeEndTime:function(t){this.endTime=t,this.setEndTimeText()},setCurrentTimeText:function(){this.curTimeDOM.innerText=this.currentTime},setEndTimeText:function(){this.endTimeDOM.innerText=this.endTime},setCurrentProgress:function(t){this.slider.changeCurrentPosition(t)},changeAudioCurrTime:function(t){this.$parent.setCurrentTime(t)}};const y=function(t){this.$parent=t,this.currentValue=.5,this.max=1,this.min=0,this.volumeArea=null,this.slider=new f(this,!1,100*this.currentValue),this.init()};y.prototype={init:function(){const{createEle:t,append:e}=p,n=t("fa fa-volume-up icon__volume","i"),i=t("audio-volume");e(i,[n,this.slider.sliderBox]),this.volumeArea=i},setCurrentVolume:function(t){this.currentValue=t,this.$parent.setCurrentVolume(t)}};let T=new d;o.onclick=function(t){let n=t.target.innerText;"B"===t.target.tagName&&(a=0,T.pause(),c.innerText=n,i=n,u=i,commitQuery(i),s.forEach((t,i)=>{if(t.includes(n)){e=t,T.pause();let n=document.querySelector(".audio");n.innerHTML="";let r=s;s=[s[i]],T=new d,T.changeCurrentSrc(),T.play(),T.controller.isPlaying="ture",T.controller.stateIcon.className=T.controller.stateIcon.className.replace("fa-play","fa-pause"),s=r}}))}}(window);